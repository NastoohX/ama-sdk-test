<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>C API Programming Guide &mdash; AMD AMA 0.0 (Production) documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Card Management" href="card_management.html" />
    <link rel="prev" title="Managing Video Acceleration Compute Resources" href="managing_compute_resources.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="index.html" class="icon icon-home"> AMD AMA
            <img src="_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_on_prem.html">On Premises</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Tutorials and Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="specs_and_features.html">Specs and Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_ffmpeg.html">Using FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuning_video_quality.html">Tuning Video Quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuning_pipeline_latency.html">Tuning Latency of Transcode Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="managing_compute_resources.html">Managing Compute Resources</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">C API Programming Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-application-development-guide">General Application Development Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#resource-initialization-and-allocation">Resource Initialization and Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#session-creation">Session Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#runtime-processing">Runtime Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cleanup">Cleanup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compiling-and-linking-with-the-sdk-plugins">Compiling and Linking with the AMD AMA Video SDK Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-xma-data-structures">Common XMA Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#decoder-plugin-reference">Decoder Plugin Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#decoder-interface">Decoder Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decoder-properties">Decoder Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#scaler-plugin-reference">Scaler Plugin Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scaler-interface">Scaler Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scaler-properties">Scaler Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#encoder-plugin-reference">Encoder Plugin Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#encoder-interface">Encoder Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encoder-properties">Encoder Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#filter-plugin-reference">Filter Plugin Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#filter-interface">Filter Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filter-properties">Filter Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#xrm-api-reference">XRM API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#decoder-resource-reservation-with-xrm">Decoder Resource Reservation with XRM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encoder-resource-reservation-with-xrm">Encoder Resource Reservation with XRM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scaler-resource-reservation-with-xrm">Scaler Resource Reservation with XRM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="card_management.html">Card Management</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/video-sdk/issues">File an issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/video-sdk/browse.html">Other versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AMD AMA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>C API Programming Guide</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>This Page is a Placeholder. Ignore the Instruction Set.</p>
<section id="c-api-programming-guide">
<span id="id1"></span><h1>C API Programming Guide<a class="headerlink" href="#c-api-programming-guide" title="Permalink to this headline">Â¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id3">Overview</a></p></li>
<li><p><a class="reference internal" href="#general-application-development-guide" id="id4">General Application Development Guide</a></p></li>
<li><p><a class="reference internal" href="#compiling-and-linking-with-the-sdk-plugins" id="id5">Compiling and Linking with the AMD AMA Video SDK Plugins</a></p></li>
<li><p><a class="reference internal" href="#common-xma-data-structures" id="id6">Common XMA Data Structures</a></p></li>
<li><p><a class="reference internal" href="#decoder-plugin-reference" id="id7">Decoder Plugin Reference</a></p></li>
<li><p><a class="reference internal" href="#scaler-plugin-reference" id="id8">Scaler Plugin Reference</a></p></li>
<li><p><a class="reference internal" href="#encoder-plugin-reference" id="id9">Encoder Plugin Reference</a></p></li>
<li><p><a class="reference internal" href="#filter-plugin-reference" id="id10">Filter Plugin Reference</a></p></li>
<li><p><a class="reference internal" href="#xrm-api-reference" id="id11">XRM API Reference</a></p></li>
</ul>
</div>
<section id="overview">
<h2><a class="toc-backref" href="#id3">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">Â¶</a></h2>
<p>The AMD AMA Video SDK provides a C-based application programming interface (API) which facilitates the integration of Xilinx transcoding capabilities in proprietary frameworks. This API is provided in the form of plugins leveraging the Xilinx Media Accelerator (XMA) library and the Xilinx Resource Manager (XRM) library.</p>
<p class="rubric">The XMA Library</p>
<p>The XMA library (libxma) is meant to simplify the development of applications managing and controlling video accelerators such as decoders, scalers, filters, and encoders.</p>
<p class="rubric">The XRM Library</p>
<p>The XRM library is used to manage the hardware accelerators available in the system. XRM keeps track of total system capacity for each of the compute units such as the decoder, scaler, and encoder. The XRM library makes it possible to perform actions such as reserving, allocating and releasing resources; calculating resource load and max capacity.</p>
<p class="rubric">The AMD AMA Video SDK Plugins</p>
<p>The AMD AMA Video SDK provides 4 different plugins, each corresponding to a specific hardware accelerated feature of the card:</p>
<ul class="simple">
<li><p>The decoder plugin</p></li>
<li><p>The encoder plugin</p></li>
<li><p>The filter plugin</p></li>
<li><p>The scaler plugin</p></li>
</ul>
<p>Any combination of plugins can be used when integrating with a proprietary framework.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="general-application-development-guide">
<h2><a class="toc-backref" href="#id4">General Application Development Guide</a><a class="headerlink" href="#general-application-development-guide" title="Permalink to this headline">Â¶</a></h2>
<p>Integration layers for applications using the AMD AMA Video SDK are organized around the following steps:</p>
<ol class="arabic simple">
<li><p>Initialization</p></li>
<li><p>Resource Reservation</p></li>
<li><p>Session Creation</p></li>
<li><p>Runtime Processing</p></li>
<li><p>Cleanup</p></li>
</ol>
<section id="resource-initialization-and-allocation">
<h3>Resource Initialization and Allocation<a class="headerlink" href="#resource-initialization-and-allocation" title="Permalink to this headline">Â¶</a></h3>
<p>Applications using the plugins must first create a XRM plugin using the <code class="xref c c-func docutils literal notranslate"><span class="pre">xrm_PLUGIN_reserve()</span></code>, where PLUGIN is one of dec, enc, or scale. This is done using the XRM APIs, as described in detail in the <a class="reference internal" href="#xrm-api-reference"><span class="std std-ref">XRM API Reference Guide</span></a> below.</p>
</section>
<section id="session-creation">
<h3>Session Creation<a class="headerlink" href="#session-creation" title="Permalink to this headline">Â¶</a></h3>
<p>Once the resources have been allocated, the application must create dedicated plugin sessions for each of the hardware accelerators that need to be used (decoder, scaler, encoder, filter).</p>
<p>To create a session, the application must first initialize all the required properties and parameters of the particular plugin. It must then call the  corresponding session creation function. A complete reference for all the plugins is provided below.</p>
</section>
<section id="runtime-processing">
<h3>Runtime Processing<a class="headerlink" href="#runtime-processing" title="Permalink to this headline">Â¶</a></h3>
<p>The plugins provide functions to send data from the host and receive data from the device. The data is in the form of video frames (<a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a>). It is also possible to do zero-copy operations where frames are passed from one hardware accelerator to the next without being copied back to the host. The send and receive functions are specific to each plugin and the return code should be used to determine the next suitable action. A complete reference for all the plugins is provided below.</p>
</section>
<section id="cleanup">
<h3>Cleanup<a class="headerlink" href="#cleanup" title="Permalink to this headline">Â¶</a></h3>
<p>When the application finishes, it should destroy each plugin session using the corresponding destroy function. Doing so will free the resources on the Xilinx devices for other jobs and ensure that everything is released and cleaned-up properly.</p>
<p>The application should also use the <code class="xref c c-func docutils literal notranslate"><span class="pre">xrm_PLUGIN_release()</span></code>, where PLUGIN is one of dec, enc, or scale to release allocated resources. This is done using the XRM APIs, as described in detail in the <a class="reference internal" href="#xrm-api-reference"><span class="std std-ref">XRM API Reference Guide</span></a> below.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="compiling-and-linking-with-the-sdk-plugins">
<h2><a class="toc-backref" href="#id5">Compiling and Linking with the AMD AMA Video SDK Plugins</a><a class="headerlink" href="#compiling-and-linking-with-the-sdk-plugins" title="Permalink to this headline">Â¶</a></h2>
<p>The plugins can be dynamically linked to the application. The required package to build applications is XRM. This package is provided as part of the AMD AMA Video SDK.</p>
<p>To provide the necessary declarations in your application, include the following header in your source code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;xrm.h&gt;</span>
</pre></div>
</div>
<p>To compile and link your application with the plugins, add the following lines to your CMakeList.txt file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>target_link_libraries (${PROJECT_NAME} PUBLIC xma PUBLIC xrm_interface)
target_include_directories (${PROJECT_NAME}
  PUBLIC &quot;${PROJECT_SOURCE_DIR}/include&quot;
  PUBLIC &quot;$&lt;TARGET_PROPERTY:xrm,INTERFACE_INCLUDE_DIRECTORIES&gt;&quot;)
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="common-xma-data-structures">
<h2><a class="toc-backref" href="#id6">Common XMA Data Structures</a><a class="headerlink" href="#common-xma-data-structures" title="Permalink to this headline">Â¶</a></h2>
<dl class="c struct">
<dt class="sig sig-object c" id="c.XmaParameter">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">XmaParameter</span></span></span><a class="headerlink" href="#c.XmaParameter" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>Type-Length-Value data structure used for passing custom arguments to a plugin. The declaration of <a class="reference internal" href="#c.XmaParameter" title="XmaParameter"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaParameter</span></code></a> can be found in the /opt/amd/ma35/include/xmaparam.h file.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.XmaFrameProperties">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">XmaFrameProperties</span></span></span><a class="headerlink" href="#c.XmaFrameProperties" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>Data structure describing the frame dimensions for XmaFrame. The declaration of <a class="reference internal" href="#c.XmaFrameProperties" title="XmaFrameProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrameProperties</span></code></a> can be found in the /opt/amd/ma35/include/xmabuffers.h file.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.XmaFrame">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">XmaFrame</span></span></span><a class="headerlink" href="#c.XmaFrame" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>Data structure describing a raw video frame and its buffers. <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> structures can be received from the decoder or sent to the encoder. They are also used as input and outputs for the scaler and the look-ahead. The declaration of <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> can be found in the /opt/amd/ma35/include/xmabuffers.h file.</p>
<p>The AMD AMA Video SDK plugins supports two types of frames:</p>
<ul class="simple">
<li><p><code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_HOST_BUFFER_TYPE</span></code> frames are explicitly allocated and managed by the host application. They are always copied from the host to the device and back after an operation.</p></li>
</ul>
<p>The decoder plugin only supports <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DEVICE_BUFFER_TYPE</span></code> frames and the scaler, encoder and filter plugins support both types of frames.</p>
<p><strong>NOTE</strong>: For optimal performance, it is  recommended that host buffers used for raw video frames be allocated on 4K boundaries. This can be done using <code class="xref c c-func docutils literal notranslate"><span class="pre">posix_memalign()</span></code> instead of <code class="xref c c-func docutils literal notranslate"><span class="pre">malloc()</span></code> when allocating the buffers.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.XmaDataBuffer">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">XmaDataBuffer</span></span></span><a class="headerlink" href="#c.XmaDataBuffer" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>Data structure describing a buffer containing encoded video data. <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a> structures can be sent to the decoder or received from the encoder. The declaration of <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a> can be found in the /opt/amd/ma35/include/xmabuffers.h file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="decoder-plugin-reference">
<h2><a class="toc-backref" href="#id7">Decoder Plugin Reference</a><a class="headerlink" href="#decoder-plugin-reference" title="Permalink to this headline">Â¶</a></h2>
<section id="decoder-interface">
<h3>Decoder Interface<a class="headerlink" href="#decoder-interface" title="Permalink to this headline">Â¶</a></h3>
<p>The external interface to the decoder plugin consists of the following XMA upper-edge functions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.xma_dec_session_create" title="xma_dec_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_create()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_dec_session_send_data" title="xma_dec_session_send_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_send_data()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_dec_session_get_properties" title="xma_dec_session_get_properties"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_get_properties()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_dec_session_recv_frame" title="xma_dec_session_recv_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_recv_frame()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_dec_session_destroy" title="xma_dec_session_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_destroy()</span></code></a></p></li>
</ul>
<p>The declaration of these functions can be found in the /opt/amd/ma35/include/app/xmadecoder.h file.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_dec_session_create">
<span class="n"><span class="pre">XmaDecoderSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">xma_dec_session_create</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.XmaDecoderProperties" title="XmaDecoderProperties"><span class="n"><span class="pre">XmaDecoderProperties</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dec_props</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_dec_session_create" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function creates a decoder session and must be called prior to decoding data. The hardware resources required to run the session must be previously reserved using the <a class="reference internal" href="#xrm-api-reference"><span class="std std-ref">XRM APIs</span></a> and should not be released until after the session is destroyed. The number of sessions allowed depends on several factors that include: resolution, frame rate, bit depth, and the capabilities of the hardware accelerator.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_dec_session_send_data">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_dec_session_send_data</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaDecoderSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span>, <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><span class="n"><span class="pre">XmaDataBuffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data_used</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_dec_session_send_data" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function sends input frame data to the hardware decoder by way of the plugin. The application needs to parse the input encoded stream and send one frame of data at a time in a <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a> data structure.</p>
<p>The <code class="xref c c-var docutils literal notranslate"><span class="pre">data_used</span></code> value indicates the amount of input data consumed by the decoder.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>, then the decoder was able to consume the entirety of the available data and <code class="xref c c-var docutils literal notranslate"><span class="pre">data_used</span></code> will be set accordingly. In this case, the application can proceed with fetching decoded data using the <a class="reference internal" href="#c.xma_dec_session_recv_frame" title="xma_dec_session_recv_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_recv_frame()</span></code></a> API.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_TRY_AGAIN</span></code>, then the decoder was did not consume any of the input data and <code class="xref c c-var docutils literal notranslate"><span class="pre">data_used</span></code> will be reported as 0. In this case, the application can proceed with fetching previously decoded data with the <a class="reference internal" href="#c.xma_dec_session_recv_frame" title="xma_dec_session_recv_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_recv_frame()</span></code></a> function but must send the same input again using using <a class="reference internal" href="#c.xma_dec_session_send_data" title="xma_dec_session_send_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_send_data()</span></code></a> until the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>.</p>
<p>Once the application has sent all the input frames to the decoder, it must notify the decoder by sending a null frame buffer with <code class="xref c c-var docutils literal notranslate"><span class="pre">is_eos</span></code> set to 1 in <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a> structure. The application should then continue sending null frame buffers with <code class="xref c c-var docutils literal notranslate"><span class="pre">is_eos</span></code> set to 0 in order to flush out all the output YUV frames.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_dec_session_get_properties">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_dec_session_get_properties</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaDecoderSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dec_session</span></span>, <a class="reference internal" href="#c.XmaFrameProperties" title="XmaFrameProperties"><span class="n"><span class="pre">XmaFrameProperties</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fprops</span></span><span class="sig-paren">)</span><span class="p"><span class="pre">;</span></span><a class="headerlink" href="#c.xma_dec_session_get_properties" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function returns the decoder properties such as width, height, output format, and bits per pixel.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_dec_session_recv_frame">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_dec_session_recv_frame</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaDecoderSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="n"><span class="pre">XmaFrame</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">frame</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_dec_session_recv_frame" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function tries to fetch a decoded YUV frame from the hardware accelerator.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>, a valid YUV frame pointer is available in the buffer pointer of the <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> argument. The decoder plugin only supports <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> structures of the <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DEVICE_BUFFER_TYPE</span></code> type.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_TRY_AGAIN</span></code>, then the decoder still needs some input data to produce a complete YUV output frame.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_EOS</span></code>, then the decoder has flushed out all the frames.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_dec_session_destroy">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_dec_session_destroy</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaDecoderSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_dec_session_destroy" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function destroys a decoder session that was previously created with the <a class="reference internal" href="#c.xma_dec_session_create" title="xma_dec_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_create()</span></code></a> function.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="decoder-properties">
<h3>Decoder Properties<a class="headerlink" href="#decoder-properties" title="Permalink to this headline">Â¶</a></h3>
<p>The AMD AMA Video SDK decoder is configured using a combination of standard XMA decoder properties and custom decoder parameters, both of which are specified using a <a class="reference internal" href="#c.XmaDecoderProperties" title="XmaDecoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDecoderProperties</span></code></a> data structure. The declaration of <a class="reference internal" href="#c.XmaDecoderProperties" title="XmaDecoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDecoderProperties</span></code></a> can be found in the /opt/amd/ma35/include/xmadecoder.h file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.XmaDecoderProperties">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">XmaDecoderProperties</span></span></span><a class="headerlink" href="#c.XmaDecoderProperties" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the AMD AMA Video SDK decoder.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric">Standard XMA Decoder Properties</p>
<p>When using the decoder plugin, the following members of the <a class="reference internal" href="#c.XmaDecoderProperties" title="XmaDecoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDecoderProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>hwdecoder_type</dt><dd><p>Specifying type of decoder to reserve.</p>
</dd>
<dt>params</dt><dd><p>Array of custom initialization parameters.
See the next section for the list of custom parameters supported by the decoder plugin.</p>
</dd>
<dt>param_cnt</dt><dd><p>Count of custom parameters.</p>
</dd>
<dt>width</dt><dd><p>Width in pixels of incoming video stream/data.
Valid values are even integers between 128 and 3840.
Portrait mode is supported.</p>
</dd>
<dt>height</dt><dd><p>Height in pixels of incoming video stream/data.
Valid values are even integers between 128 and 2160.</p>
</dd>
<dt>bits_per_pixel</dt><dd><p>Bits per pixel for primary plane of output video.
Must be set to 8 bits per pixel.</p>
</dd>
<dt>framerate</dt><dd><p>Framerate data structure specifying frame rate per second.
Valid values can range from 1 to integer max.</p>
</dd>
<dt>handle</dt><dd><p>handle to XMA device.</p>
</dd>
</dl>
<p class="rubric">Custom Decoder Parameters</p>
<p>In addition to the standard properties, the following <a class="reference internal" href="#c.XmaParameter" title="XmaParameter"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaParameter</span></code></a> custom parameters are supported by the decoder plugin:</p>
<dl class="simple">
<dt>âout_fmtâ</dt><dd><p>XMA pixel format. See <a class="reference internal" href="using_ffmpeg.html#cmdoption-out_fmt"><code class="xref std std-option docutils literal notranslate"><span class="pre">-out_fmt</span></code></a> for available options.</p>
</dd>
<dt>âlatency_loggingâ</dt><dd><p>Set to 1 to enable logging of latency information to syslog.</p>
</dd>
</dl>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="scaler-plugin-reference">
<h2><a class="toc-backref" href="#id8">Scaler Plugin Reference</a><a class="headerlink" href="#scaler-plugin-reference" title="Permalink to this headline">Â¶</a></h2>
<section id="scaler-interface">
<h3>Scaler Interface<a class="headerlink" href="#scaler-interface" title="Permalink to this headline">Â¶</a></h3>
<p>The external interface to the scaler plugin consists of the following XMA application-level functions:</p>
<ul class="simple">
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_default_filter_coeff_set()</span></code></p></li>
<li><p><a class="reference internal" href="#c.xma_scaler_session_create" title="xma_scaler_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_create()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_scaler_session_send_frame" title="xma_scaler_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_send_frame()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_scaler_session_recv_frame_list" title="xma_scaler_session_recv_frame_list"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_recv_frame_list()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_scaler_session_destroy" title="xma_scaler_session_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_destroy()</span></code></a></p></li>
</ul>
<p>The declaration of these functions can be found in the /opt/amd/ma35/include/xmascaler.h file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_scaler_session_create">
<span class="n"><span class="pre">XmaScalerSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">xma_scaler_session_create</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.XmaScalerProperties" title="XmaScalerProperties"><span class="n"><span class="pre">XmaScalerProperties</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">props</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_scaler_session_create" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function creates scaler session and must be called prior to sending input frames. The hardware resources required to run the session must be previously reserved using the <a class="reference internal" href="#xrm-api-reference"><span class="std std-ref">XRM APIs</span></a> and should not be released until after the session is destroyed. The number of sessions allowed depends on several factors that include: resolution, frame rate, bit depth, and the capabilities of the hardware accelerator.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_scaler_session_send_frame">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_scaler_session_send_frame</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaScalerSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="n"><span class="pre">XmaFrame</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">frame</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_scaler_session_send_frame" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function sends a YUV frame to the underlying XMA plugin( and eventually to hardware to scale the input frame to one or multiple resolutions. The application has to read one YUV frame data in semi-planar format at a time and update the buffer details in XmaFrame argument.</p>
<p>The application can take further action depending upon the return value from this API.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>, then the application can proceed to fetch scaled output frames.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SEND_MORE_DATA</span></code>, then the application should proceed with sending next yuv frame.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_FLUSH_AGAIN</span></code> it means that the application should keep flushing the scaler.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_EOS</span></code> then the scaler has been flushed and the pipeline can be exited.</p>
<p>Once the application has sent all the input frames to the scaler, it must notify the scaler by sending a null frame buffer in the <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> structure and flush the scaler. To flush the scaler, send a null frame buffer and call the <a class="reference internal" href="#c.xma_scaler_session_recv_frame_list" title="xma_scaler_session_recv_frame_list"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_recv_frame_list()</span></code></a> function for as long as <a class="reference internal" href="#c.xma_scaler_session_send_frame" title="xma_scaler_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_send_frame()</span></code></a> returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code> or <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_FLUSH_AGAIN</span></code>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_scaler_session_recv_frame_list">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_scaler_session_recv_frame_list</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaScalerSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="n"><span class="pre">XmaFrame</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">frame_list</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_scaler_session_recv_frame_list" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function is called after calling the <a class="reference internal" href="#c.xma_scaler_session_send_frame" title="xma_scaler_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_send_frame()</span></code></a>. This function returns a list of output frames with every call until it reaches end of scaling. Return codes can only be <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code> and <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_ERROR</span></code>.</p>
<p>The scaler plugin supports both <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_HOST_BUFFER_TYPE</span></code> and <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DEVICE_BUFFER_TYPE</span></code> output buffers. The application indicates the buffer type through the <a class="reference internal" href="#c.XmaFrameProperties" title="XmaFrameProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrameProperties</span></code></a> of the <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> specified in the frame list.</p>
<p>When using <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_HOST_BUFFER_TYPE</span></code> buffers, the application is responsible for allocating the host memory for each frame.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_scaler_session_destroy">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_scaler_session_destroy</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaScalerSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_scaler_session_destroy" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function destroys scaler session that was previously created with the <a class="reference internal" href="#c.xma_scaler_session_create" title="xma_scaler_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_create()</span></code></a> function.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="scaler-properties">
<h3>Scaler Properties<a class="headerlink" href="#scaler-properties" title="Permalink to this headline">Â¶</a></h3>
<p>The AMD AMA Video SDK scaler is configured using a combination of standard XMA scaler properties, standard XMA scaler input and ouput properties and custom scaler parameters, all of which are specified using <a class="reference internal" href="#c.XmaScalerProperties" title="XmaScalerProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerProperties</span></code></a> and <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> data structures.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.XmaScalerProperties">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">XmaScalerProperties</span></span></span><a class="headerlink" href="#c.XmaScalerProperties" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the video scaler. The declaration of <a class="reference internal" href="#c.XmaScalerProperties" title="XmaScalerProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerProperties</span></code></a> can be found in the /opt/amd/ma35/include/xmascaler.h file.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.XmaScalerInOutProperties">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">XmaScalerInOutProperties</span></span></span><a class="headerlink" href="#c.XmaScalerInOutProperties" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the input and outputs of the video scaler. The <code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerFilterProperties</span></code> data structure contains one <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> for the scaler input and an array of 8 <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> for the scaler outputs. The declaration of <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> can be found in the /opt/amd/ma35/include/xmascaler.h file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric">Standard XMA Scaler Properties</p>
<p>When using the scaler plugin, the following members of the <a class="reference internal" href="#c.XmaScalerProperties" title="XmaScalerProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>hwscaler_type</dt><dd><p>Vendor value used to identify the scaler type.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_ABR_SCALER_TYPE</span></code>.</p>
</dd>
<dt>num_outputs</dt><dd><p>Number of scaler outputs.</p>
</dd>
<dt>params</dt><dd><p>Array of custom initialization parameters.
See the next section for the list of custom parameters supported by the scaler plugin.</p>
</dd>
<dt>param_cnt</dt><dd><p>Count of custom parameters.</p>
</dd>
<dt>input</dt><dd><p>Input property of type <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a></p>
</dd>
<dt>output</dt><dd><p>Output properties an array of type <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> of size <code class="docutils literal notranslate"><span class="pre">num_outputs</span></code></p>
</dd>
</dl>
<p class="rubric">XMA Scaler Input and Output Properties</p>
<p>When configuring the scaler input and outputs, the following members of the <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>format</dt><dd><p>Host side input video format.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_VPE_FMT_TYPE</span></code></p>
</dd>
<dt>format_sw</dt><dd><p>Device side input video format. See <a class="reference internal" href="using_ffmpeg.html#cmdoption-out_res"><code class="xref std std-option docutils literal notranslate"><span class="pre">-out_res</span></code></a> for available options.</p>
</dd>
<dt>width</dt><dd><p>Width in pixels of incoming video stream/data.
Valid values are integers between 128 and 3840, in multiples of 4.
Portrait mode is supported.</p>
</dd>
<dt>height</dt><dd><p>Height in pixels of incoming video stream/data.
Valid values are even integers between 128 and 2160, in multiples of 4.</p>
</dd>
<dt>stride</dt><dd><p>Stride must be set as input width aligned by 256.</p>
</dd>
<dt>framerate</dt><dd><p>Framerate data structure specifying frame rate per second of the input stream.</p>
</dd>
</dl>
<p>Other members of <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> are not applicable to the scaler plugin and should not be used.</p>
<p class="rubric">Custom Scaler Parameters</p>
<p>In addition to the standard properties, the following <a class="reference internal" href="#c.XmaParameter" title="XmaParameter"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaParameter</span></code></a> custom parameters are supported by the scaler plugin:</p>
<dl class="simple">
<dt>âmix_rateâ</dt><dd><p>This parameter is used to configure mix-rate sessions where some scaler outputs are configured at the input frame rate and some other outputs will be configured at half the rate.</p>
</dd>
<dt>âlatency_loggingâ</dt><dd><p>Set to 1 to enable logging of latency information to syslog. Set to 0 to disable logging.</p>
</dd>
</dl>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="encoder-plugin-reference">
<h2><a class="toc-backref" href="#id9">Encoder Plugin Reference</a><a class="headerlink" href="#encoder-plugin-reference" title="Permalink to this headline">Â¶</a></h2>
<section id="encoder-interface">
<h3>Encoder Interface<a class="headerlink" href="#encoder-interface" title="Permalink to this headline">Â¶</a></h3>
<p>The external interface to the encoder plugin consists of the following XMA application-level functions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.xma_enc_session_create" title="xma_enc_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_create()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_enc_session_destroy" title="xma_enc_session_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_destroy()</span></code></a></p></li>
</ul>
<p>The declaration of these functions can be found in the /opt/amd/ma35/include/xmaencoder.h file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_enc_session_create">
<span class="n"><span class="pre">XmaEncoderSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">xma_enc_session_create</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.XmaEncoderProperties" title="XmaEncoderProperties"><span class="n"><span class="pre">XmaEncoderProperties</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">enc_props</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_enc_session_create" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function creates an encoder session and must be called prior to encoding input YUV. The hardware resources required to run the session must be previously reserved using the <a class="reference internal" href="#xrm-api-reference"><span class="std std-ref">XRM APIs</span></a> and should not be released until after the session is destroyed. The number of sessions allowed depends on several factors that include: resolution, frame rate, bit depth, and the capabilities of the hardware accelerator.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_enc_session_send_frame">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_enc_session_send_frame</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaEncoderSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="n"><span class="pre">XmaFrame</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">frame</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_enc_session_send_frame" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function sends a YUV frame to the hardware encoder by way of the plugin.</p>
<p>Each time the application calls this function, it must provide valid pointer to a <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> structure containing a YUV frame in semi-planar format (<code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaBufferRef</span></code>) and information about this frame (<a class="reference internal" href="#c.XmaFrameProperties" title="XmaFrameProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrameProperties</span></code></a>).</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>, then the application can proceed to fetch the encoded data using the <a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a> API.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SEND_MORE_DATA</span></code>, then the application must send the next YUV frame before calling <a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a>.</p>
<p>Once the application has sent all the input frames to the encoder, it should notify the hardware by sending a null frame buffer and set <code class="xref c c-var docutils literal notranslate"><span class="pre">is_last_frame</span></code> to 1 in the <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> structure. If the API returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_FLUSH_AGAIN</span></code> after a null frame is sent, then the application can call <a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a> but must send a null frame again. Once the null frame is sent successfully, does not need to send frames anymore and can simply call <a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a> to flush out all the remaining output frames.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_enc_session_recv_data">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_enc_session_recv_data</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaEncoderSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span>, <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><span class="n"><span class="pre">XmaDataBuffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data_size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_enc_session_recv_data" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function is called after calling the function <a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a>. The application is the owner of the <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a>. It is responsible for allocating it and for releasing it when done.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code> and if <code class="xref c c-var docutils literal notranslate"><span class="pre">data_size</span></code> is greater than 0, then a valid output frame is available. The returned data (<code class="xref c c-var docutils literal notranslate"><span class="pre">XmaDataBuffer.data</span></code>) is valid until the next call to the <a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a>, so the application must use or copy it before calling <a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a> again. The XMA encoder plugin is responsible for setting the fields of the <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a> struct. That is, <code class="xref c c-var docutils literal notranslate"><span class="pre">XmaDataBuffer.data</span></code> is set by the XMA plugin and does not transfer the ownership of this buffer to the application. The application must not attempt to free <code class="xref c c-var docutils literal notranslate"><span class="pre">XmaDataBuffer.data</span></code>. The encoder plugin will recycle the data buffers in the next call to the <a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a> function.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_TRY_AGAIN</span></code>, a data buffer is not ready to be returned and the length of the data buffer is set to 0.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_EOS</span></code>, the encoder has flushed all the output frames.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_enc_session_destroy">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_enc_session_destroy</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaEncoderSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_enc_session_destroy" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function destroys an encoder session that was previously created with the <a class="reference internal" href="#c.xma_enc_session_create" title="xma_enc_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_create()</span></code></a> function.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="encoder-properties">
<h3>Encoder Properties<a class="headerlink" href="#encoder-properties" title="Permalink to this headline">Â¶</a></h3>
<p>The AMD AMA Video SDK encoder is configured using a combination of standard XMA encoder properties and custom encoder parameters, both of which are specified using a <a class="reference internal" href="#c.XmaEncoderProperties" title="XmaEncoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaEncoderProperties</span></code></a> data structure.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.XmaEncoderProperties">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">XmaEncoderProperties</span></span></span><a class="headerlink" href="#c.XmaEncoderProperties" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the video encoder. The declaration of <a class="reference internal" href="#c.XmaEncoderProperties" title="XmaEncoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaEncoderProperties</span></code></a> can be found in the /opt/amd/ma35/include/xmaencoder.h file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric">Standard XMA Encoder Properties</p>
<p>When using the encoder plugin, the following members of the <a class="reference internal" href="#c.XmaEncoderProperties" title="XmaEncoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaEncoderProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>hwencoder_type</dt><dd><p>Vendor value used to identify the encoder type.</p>
</dd>
<dt>format</dt><dd><p>Host side input video format.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_VPE_FMT_TYPE</span></code></p>
</dd>
<dt>format_sw</dt><dd><p>Device side input video format. See <a class="reference internal" href="using_ffmpeg.html#cmdoption-out_res"><code class="xref std std-option docutils literal notranslate"><span class="pre">-out_res</span></code></a> for available options.</p>
</dd>
<dt>width</dt><dd><p>Width in pixels of incoming video stream/data.
Valid values are even integers between 128 and 3840.
Portrait mode is supported.</p>
</dd>
<dt>height</dt><dd><p>Height in pixels of incoming video stream/data.
Valid values are even integers between 128 and 2160.</p>
</dd>
<dt>framerate</dt><dd><p>Framerate data structure specifying frame rate per second</p>
</dd>
<dt>lookahead_depth</dt><dd><p>The lookahead module depth to give start giving lookahead data.
Supported values are 0 to 20.</p>
</dd>
<dt>rc_mode</dt><dd><p>Rate control mode for custom rate control
Supported values are 0 (custom rate control disabled) and 1 (enabled)</p>
</dd>
<dt>params</dt><dd><p>Array of custom initialization parameters.
See the next section for the list of custom parameters supported by the encoder plugin.</p>
</dd>
<dt>param_cnt</dt><dd><p>Count of custom parameters.</p>
</dd>
</dl>
<p class="rubric">Custom Encoder Parameters</p>
<p>In addition to the standard properties, the following <a class="reference internal" href="#c.XmaParameter" title="XmaParameter"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaParameter</span></code></a> custom parameters are supported by the encoder plugin:</p>
<dl class="simple">
<dt>âsliceâ</dt><dd><p>Slice to perform the encode.</p>
</dd>
<dt>âlatency_loggingâ</dt><dd><p>When enabled, it logs latency information to syslog.</p>
</dd>
<dt>âlatency_modeâ</dt><dd><p>Sets the latency mode to low, ultra-low or normal.</p>
</dd>
<dt>âspatial_aqâ</dt><dd><p>Enables or disables adaptive spatial qp.</p>
</dd>
<dt>âtemporal_aqâ</dt><dd><p>Enables or disables adaptive temporal qp.</p>
</dd>
<dt>âqp_modeâ</dt><dd><p>Sets qp mode to auto, relative load or uniform.</p>
</dd>
<dt>âtune_metricsâ</dt><dd><p>Sets the tuning metric to none, VQ, PSNR, SSIM or VMAF.</p>
</dd>
<dt>âforced_idrâ</dt><dd><p>Forces insertion of an IDR.</p>
</dd>
<dt>âcrfâ</dt><dd><p>Enables or disables CRF.</p>
</dd>
<dt>âexpert_optionsâ</dt><dd><p>sets encoderâs expert option.</p>
</dd>
<dt>âdevice_typeâ</dt><dd><p>For AV1 encoder selects between Type 1 and Type 2.</p>
</dd>
</dl>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="filter-plugin-reference">
<h2><a class="toc-backref" href="#id10">Filter Plugin Reference</a><a class="headerlink" href="#filter-plugin-reference" title="Permalink to this headline">Â¶</a></h2>
<section id="filter-interface">
<h3>Filter Interface<a class="headerlink" href="#filter-interface" title="Permalink to this headline">Â¶</a></h3>
<p>The filter plugin is based on the Filter XMA plugin type. The external interface to the filter plugin consists of the following XMA application-level functions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.xma_filter_session_create" title="xma_filter_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_create()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_filter_session_send_frame" title="xma_filter_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_send_frame()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_filter_session_recv_frame" title="xma_filter_session_recv_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_recv_frame()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_filter_session_destroy" title="xma_filter_session_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_destroy()</span></code></a></p></li>
</ul>
<p>The declaration of these functions can be found in the /opt/amd/ma35/include/xmafilter.h file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_filter_session_create">
<span class="n"><span class="pre">XmaFilterSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">xma_filter_session_create</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.XmaFilterProperties" title="XmaFilterProperties"><span class="n"><span class="pre">XmaFilterProperties</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">props</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_filter_session_create" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function creates filter session and must be called prior to sending yuv frame to filter filter. The hardware resources required to run the session must be previously reserved using the <a class="reference internal" href="#xrm-api-reference"><span class="std std-ref">XRM APIs</span></a> and should not be released until after the session is destroyed. The number of sessions allowed depends on several factors that include: resolution, frame rate, bit depth, and the capabilities of the hardware accelerator.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_filter_session_send_frame">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_filter_session_send_frame</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaFilterSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="n"><span class="pre">XmaFrame</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">frame</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_filter_session_send_frame" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function sends YUV frame to the underlying XMA plugin(lower-edge interface) and eventually to filter module in hardware. The application has to read one YUV frame data in semi-planar format at a time and update the details of the buffer in the <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> argument.
The application can take further action depending upon the return value from this API.</p>
<p>If this function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>, then the application can proceed to fetch filter side data along with the output frame.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SEND_MORE_DATA</span></code>, then the application should proceed with sending next YUV frame.</p>
<p>If this function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_TRY_AGAIN</span></code>, it means the input frame has not been consumed and needs to resend the same input frame after calling receive frame.</p>
<p>Once the application sends all input frames to the filter module, it should continue sending null frames until all the frames have been flushed out from the filter.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_filter_session_recv_frame">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_filter_session_recv_frame</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaFilterSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="n"><span class="pre">XmaFrame</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">frame</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_filter_session_recv_frame" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function is called after calling the function <a class="reference internal" href="#c.xma_filter_session_send_frame" title="xma_filter_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_send_frame()</span></code></a>. If an output frame is not ready to be returned, this function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_TRY_AGAIN</span></code>. This function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code> if the output frame is available.</p>
<p>The filter plugin provides the output frame and the application needs to release the frame after successfully sending it to the encoder and before calling the next <a class="reference internal" href="#c.xma_filter_session_send_frame" title="xma_filter_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_send_frame()</span></code></a>.</p>
<p>Once the filter flushes all the frames, it returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_EOS</span></code>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xma_filter_session_destroy">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xma_filter_session_destroy</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XmaFilterSession</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">session</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_filter_session_destroy" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function destroys the filter session that was previously created with the <a class="reference internal" href="#c.xma_filter_session_create" title="xma_filter_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_create()</span></code></a> function.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="filter-properties">
<h3>Filter Properties<a class="headerlink" href="#filter-properties" title="Permalink to this headline">Â¶</a></h3>
<p>The AMD AMA Video SDK filter is configured using a combination of standard XMA filter properties, standard XMA filter input and output properties and custom filter parameters, all of which are specified using <a class="reference internal" href="#c.XmaFilterProperties" title="XmaFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterProperties</span></code></a> and <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> data structures.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.XmaFilterProperties">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">XmaFilterProperties</span></span></span><a class="headerlink" href="#c.XmaFilterProperties" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the filter function. The declaration of <a class="reference internal" href="#c.XmaFilterProperties" title="XmaFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterProperties</span></code></a> can be found in the /opt/amd/ma35/include/xmafilter.h file.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.XmaFilterPortProperties">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">XmaFilterPortProperties</span></span></span><a class="headerlink" href="#c.XmaFilterPortProperties" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the input and output of the filter. The <a class="reference internal" href="#c.XmaFilterProperties" title="XmaFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterProperties</span></code></a> data structure contains one <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> for the filter input and one <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> for the output output. The declaration of <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> can be found in the /opt/amd/ma35/include/xmafilter.h file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric">Standard XMA Filter Properties</p>
<p>When using the filter plugin, the following members of the <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>hwfilter_type</dt><dd><p>Sets the direction of stream entry to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_UPLOAD_FILTER_TYPE</span></code> or <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DOWNLOAD_FILTER_TYPE</span></code>.</p>
</dd>
<dt>params</dt><dd><p>Array of custom initialization parameters.
See the next section for the list of custom parameters supported by the filter plugin.</p>
</dd>
<dt>param_cnt</dt><dd><p>Count of custom parameters.</p>
</dd>
<dt>input</dt><dd><p>Input property of type :c:struct:` XmaFilterPortProperties`</p>
</dd>
<dt>output</dt><dd><p>Output property of type :c:struct:` XmaFilterPortProperties`</p>
</dd>
</dl>
<p class="rubric">Standard XMA Filter Port Properties</p>
<p>When configuring the filter input or output, the following members of the <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>format</dt><dd><p>Input video format.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_VCU_NV12_FMT_TYPE</span></code>.</p>
</dd>
<dt>format</dt><dd><p>Host side input video format.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_VPE_FMT_TYPE</span></code></p>
</dd>
<dt>format_sw</dt><dd><p>Device side input video format. See <a class="reference internal" href="using_ffmpeg.html#cmdoption-out_res"><code class="xref std std-option docutils literal notranslate"><span class="pre">-out_res</span></code></a> for available options.</p>
</dd>
<dt>width</dt><dd><p>Width in pixels of incoming video stream/data.
Valid values are even integers between 128 and 3840
Portrait mode is supported.</p>
</dd>
<dt>height</dt><dd><p>Height in pixels of incoming video stream/data.
Valid values are even integers between 128 and 2160.</p>
</dd>
<dt>stride</dt><dd><p>Stride value should be width with 256 alignment.</p>
</dd>
<dt>flags</dt><dd><p>Sets frame property to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_FRAME_PROPERTY_FLAG_TILE_4x4</span></code> or <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_NV12_FMT_TYPE</span></code></p>
</dd>
<dt>framerate</dt><dd><p>Framerate data structure specifying frame rate per second.</p>
</dd>
</dl>
<p class="rubric">Custom Filter Parameters</p>
<p>In addition to the standard properties, the following <a class="reference internal" href="#c.XmaParameter" title="XmaParameter"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaParameter</span></code></a> custom parameters are supported by the filter plugin:</p>
<dl class="simple">
<dt>âthicknessâ</dt><dd><p>Sets the thickness of a draw box line</p>
</dd>
<dt>âlatency_loggingâ</dt><dd><p>When enabled, it logs latency information to syslog.</p>
</dd>
<dt>âcolorâ</dt><dd><p>Sets the color of a draw box line.</p>
</dd>
</dl>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
<section id="xrm-api-reference">
<span id="id2"></span><h2><a class="toc-backref" href="#id11">XRM API Reference</a><a class="headerlink" href="#xrm-api-reference" title="Permalink to this headline">Â¶</a></h2>
<p>The XilinxÂ® FPGA Resource Manager (XRM) library is used to manage the hardware accelerators available in the system. XRM keeps track of total system capacity for each of the compute units such as the decoder, scaler, and encoder.</p>
<p>The XRM library includes a daemon, a command line tool and a C application programming interface (API). Using the library API, external applications can communicate with the XRM daemon and perform actions such as reserving, allocating and releasing resources.</p>
<p>More details on the XRM command line tool (xrmadm) and the XRM daemon (xrmd) can be found in the <a class="reference internal" href="managing_compute_resources.html#xrm-reference"><span class="std std-ref">XRM Reference Guide</span></a> section of the documentation.</p>
<p>The XRM C APIs are defined in <code class="file docutils literal notranslate"><span class="pre">xrm.h</span></code>.</p>
<section id="decoder-resource-reservation-with-xrm">
<h3>Decoder Resource Reservation with XRM<a class="headerlink" href="#decoder-resource-reservation-with-xrm" title="Permalink to this headline">Â¶</a></h3>
<p>The decoder plugin uses the following function to reserve and release resources:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.xrm_dec_reserve" title="xrm_dec_reserve"><code class="xref c c-func docutils literal notranslate"><span class="pre">xrm_dec_reserve()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xrm_dec_release" title="xrm_dec_release"><code class="xref c c-func docutils literal notranslate"><span class="pre">xrm_dec_release()</span></code></a></p></li>
</ul>
<p>The declaration of these functions can be found in the /opt/amd/ma35/include/xrm_dec_interface.h file.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.xrm_dec_reserve">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xrm_dec_reserve</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XrmDecodeContext</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">xrm_dec_ctx</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">dev_index</span></span>, <span class="n"><span class="pre">XrmInterfaceProperties</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">xrm_props</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xrm_dec_reserve" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function checks and allocates the necessary xrm resources given the relevant decoder parameters</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.xrm_dec_release">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xrm_dec_release</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XrmDecodeContext</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">xrm_dec_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xrm_dec_release" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function releases the xrm resources which were allocated.</p>
<p>XrmDecodeContext is defined in /opt/amd/ma35/include/xrm_dec_interface.h file.</p>
</section>
<section id="encoder-resource-reservation-with-xrm">
<h3>Encoder Resource Reservation with XRM<a class="headerlink" href="#encoder-resource-reservation-with-xrm" title="Permalink to this headline">Â¶</a></h3>
<p>The encoder plugin uses the following function to reserve and release resources:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.xrm_enc_reserve" title="xrm_enc_reserve"><code class="xref c c-func docutils literal notranslate"><span class="pre">xrm_enc_reserve()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xrm_enc_release" title="xrm_enc_release"><code class="xref c c-func docutils literal notranslate"><span class="pre">xrm_enc_release()</span></code></a></p></li>
</ul>
<p>The declaration of these functions can be found in the /opt/amd/ma35/include/xrm_enc_interface.h file.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.xrm_enc_reserve">
<span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xrm_enc_reserve</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XrmEncodeContext</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">xrm_enc_ctx</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">dev_index</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">slice_id</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">is_xav1</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">is_ull</span></span>, <span class="n"><span class="pre">XrmInterfaceProperties</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">xrm_props</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xrm_enc_reserve" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function checks and allocates the necessary xrm resources given the relevant encoder parameters</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.xrm_enc_release">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xrm_enc_release</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XrmEncodeContext</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">xrm_enc_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xrm_enc_release" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function releases the xrm resources which were allocated.</p>
<p>XrmEncodeContext is defined in /opt/amd/ma35/include/xrm_enc_interface.h file.</p>
</section>
<section id="scaler-resource-reservation-with-xrm">
<h3>Scaler Resource Reservation with XRM<a class="headerlink" href="#scaler-resource-reservation-with-xrm" title="Permalink to this headline">Â¶</a></h3>
<p>The scaler plugin uses the following function to reserve and release resources:</p>
<ul class="simple">
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">xrm_scale_reserve()</span></code></p></li>
<li><p><a class="reference internal" href="#c.xrm_scale_release" title="xrm_scale_release"><code class="xref c c-func docutils literal notranslate"><span class="pre">xrm_scale_release()</span></code></a></p></li>
</ul>
<p>The declaration of these functions can be found in the /opt/amd/ma35/include/xrm_scale_interface.h file.</p>
<dl class="c function">
<dt class="sig sig-object c">
<span class="sig-name descname"><span class="pre">int32_t</span> <span class="pre">xrm_scale_reserve(XrmScaleContext*</span> <span class="pre">scaler_xrm_ctx,</span> <span class="pre">int</span> <span class="pre">dev_index,</span> <span class="pre">XrmInterfaceProperties*</span> <span class="pre">input_props,</span> <span class="pre">XrmInterfaceProperties*</span> <span class="pre">output_props,</span> <span class="pre">int</span> <span class="pre">num_outputs)</span> <span class="pre">{</span></span></dt>
<dd></dd></dl>

<p>This function checks and allocates the necessary xrm resources given the relevant encoder parameters</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.xrm_scale_release">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xrm_scale_release</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">XrmScaleContext</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">scaler_xrm_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xrm_scale_release" title="Permalink to this definition">Â¶</a><br /></dt>
<dd></dd></dl>

<p>This function releases the xrm resources which were allocated.</p>
<p>XrmScaleContext is defined in /opt/amd/ma35/include/xrm_scale_interface.h file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="managing_compute_resources.html" class="btn btn-neutral float-left" title="Managing Video Acceleration Compute Resources" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="card_management.html" class="btn btn-neutral float-right" title="Card Management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on May 18, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>